@using Microsoft.AspNetCore.Components
﻿@using OServcies.FiltersServcies.FilterModels
@using OzonDomains.Models
@using OzonDomains.ViewModels
@using OzonOrdersWeb.ViewModels.OrderViewModels
@using Servcies.FiltersServcies.SortModels

@model OrderPageViewModel<Order, OrderFilterModel>

<script asp-src-include="~/js/**/*.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<meta charset="UTF-8">

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<style>
    #shipmentTable small,
    #shipmentTable input,
    #shipmentTable td {
        font-size: 13px;
    }

    .custom-gray {
        background-color: #585858;
        color: #fff;
    }

        .custom-gray:hover {
            color: #fff;
        }

    .custom-red {
        background-color: #DC143C;
        color: #fff;
    }

        .custom-red:hover {
            color: #fff;
        }

    .product-popup {
        display: none;
        position: absolute;
        z-index: 1;
    }

    .product-cell {
        font-size: 11px;
    }

        .product-cell:hover .product-popup {
            display: block;
        }

    #processingDateFilter {
        width: 80px;
    }

    #shippingDateFilter {
        width: 80px;
    }

    a {
        text-decoration: none;
    }

    .horizontal-line {
        border-top: 1px solid #ccc;
        margin: 20px 0;
    }

    #infoWindow {
        position: fixed;
        display: none;
        border: 1px solid #ccc;
        background-color: #fff;
        padding: 10px;
        z-index: 9999;
    }

    th.active {
        background-color: #f4f4f4; /* Цвет подсветки */
    }

    .button-container {
        display: flex;
        gap: 10px; /* Расстояние между кнопками */
    }

    .horizontal-inputs {
        display: flex;
        align-items: center;
    }
    .horizontal-inputs > div {
        margin-right: 10px; /* Отступ между элементами */
    }

    .form-check-label {
        user-select: none; /* предотвращает выделение текста */
        cursor: pointer; /* меняет курсор при наведении */
    }

    /* Изначально скрываем кнопку */
    .clear-btn {
        display: none;
        position: absolute;
        left: 100%;
        transform: translateX(0) translateY(-50%); /* Прижимаем к основной кнопке и центрируем по вертикали */
        z-index: 10; /* Поверх других элементов */
        top: 50%; /* Центрируем по вертикали относительно главной кнопки */
        opacity: 0; /* Прозрачность кнопки */
        border: solid 1px;
        white-space: nowrap;
    }

        /* Показываем кнопку при наведении на основную или на саму кнопку очистки */
        .btn-container:hover .clear-btn,
        .clear-btn:hover {
            display: block;
            opacity: 1; /* Увеличиваем непрозрачность при наведении */
            border: solid 1px;
        }

    /* Обёртка для кнопок */
    .btn-container {
        position: relative;
        display: inline-block;
    }

    }
</style>
@{
    int[]? uploadResult = (int[])ViewData["UploadResult"];
    string uploadResultPeriod = (string)ViewData["UploadResultPeriod"];
    string transactionResult = (string)ViewData["TransactionResult"];
    string erorrResult = (string)ViewData["ErorrResult"];
    
}

@if (uploadResult != null)
{
    <div class="alert alert-dismissible alert-success">
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        <p>Файл успешно загружен! <br />Результат: <br />Добавлено @uploadResult[0] строк.<br />Обновлено @uploadResult[1] строк.</p>
        @if (uploadResultPeriod != null)
        {
            <p>Период @Html.Raw(@uploadResultPeriod)</p>
        }
    </div>
}

@if (transactionResult != null)
{
    <div class="alert alert-dismissible alert-success">
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        <p>@Html.Raw(transactionResult)</p>
    </div>
}
@if (erorrResult != null)
{
    <div class="alert alert-dismissible alert-danger">
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        <p>@Html.Raw(erorrResult)</p>
    </div>
}
@{
    var buttonState = ViewData["ButtonState"] as string ?? "";
}

<form id="filterForm" asp-action="Index" method="post" class="d-flex justify-content-between align-items-center">
    <div class="button-container">
        <label>
            <input type="radio" name="buttonState" value="returnable" onchange="submitForm()" @(buttonState == "returnable" ? "checked" : "")> Возврат поставщику (@Model.ReturnableCount)
        </label>
        <label>
            <input type="radio" name="buttonState" value="activated" onchange="submitForm()" @(buttonState == "activated" ? "checked" : "")> Проверенные
        </label>
        <label>
            <input type="radio" name="buttonState" value="notActivated" onchange="submitForm()" @(buttonState == "notActivated" ? "checked" : "")> Не проверенные
        </label>
        <label>
            <input type="radio" name="buttonState" value="changed" onchange="submitForm()" @(buttonState == "changed" ? "checked" : "")> Измёненные
        </label>
        <label>
            <input type="radio" name="buttonState" value="accepted" onchange="submitForm()" @(buttonState == "accepted" ? "checked" : "")> Подтвержденные
        </label>
        <label>
            <input type="radio" name="buttonState" value="all" onchange="submitForm()" @(buttonState == "all" ? "checked" : "")> Все
        </label>
        <label>
            <div class="dropdown">
                <button id="uniqueDropdownToggle" class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                    Провести документ
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                </ul>
            </div>
        </label>
        <label>
            <div class="dropdown">
                <button id="printLableDropdownToggle" class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false" title="Печать этикеток заказов">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-printer" viewBox="0 0 16 16">
                        <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1" />
                        <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1" />
                    </svg>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                </ul>
            </div>
        </label>
        <label>
            <button type="button" class="btn btn-danger" onclick="clearSelectedIdsSession()">Очистить выбранные поля</button>
        </label>
        
    </div>

    <button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#exampleModal" type="submit" style="width: 18px; height: 18x;" title="Настройка отображения таблицы">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear-fill" viewBox="0 0 16 16">
            <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z" />
        </svg>
        <span class="visually-hidden">Button</span>
    </button>

</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var dropdownToggle = document.getElementById('uniqueDropdownToggle');
        var dropdownMenu = dropdownToggle.nextElementSibling;

        dropdownToggle.addEventListener('click', function () {
            dropdownMenu.innerHTML = '';
            // Получаем выбранные ID из сессии
            getSelectedIdsFromSession(function (selectedIds) {
                if (selectedIds.length > 0) {
                    var listItem1 = document.createElement('li');
                    listItem1.className = 'dropdown-item';
                    listItem1.innerHTML = '<a href="#" onclick="openOrderForm()" class="btn btn-link">Заказан поставщику</a>';
                    dropdownMenu.appendChild(listItem1);
                } else {
                    var listItem1 = document.createElement('li');
                    listItem1.className = 'dropdown-item';
                    listItem1.innerHTML = 'Нет выбранных заказов';
                    dropdownMenu.appendChild(listItem1);
                }
            });
        });
    });

    // Функция для получения выбранных ID из сессии
    function getSelectedIdsFromSession(callback) {
        $.get('/YourController/GetSelectedIdsFromSession', function (data) {
            callback(data);
        });
    }

    // Пример функции для открытия формы заказа
    function openOrderForm() {
        // Используйте getSelectedIdsFromSession для получения ID
        getSelectedIdsFromSession(function (selectedIds) {
            var url = '/Orders/CreateOrderToSupplierTransaction?ids=' + selectedIds.join(',') + '&page=' + @Model.PageNumber;
            window.location.href = url;
        });
    }
</script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        var dropdownToggle = document.getElementById('printLableDropdownToggle');
        var dropdownMenu = dropdownToggle.nextElementSibling;

        dropdownToggle.addEventListener('click', function () {
            dropdownMenu.innerHTML = '';

            getSelectedIdsFromSession(function (selectedIds) {
                if (selectedIds.length > 0) {
                    var listItem1 = document.createElement('li');
                    listItem1.className = 'dropdown-item';
                    listItem1.innerHTML = '<a href="#" onclick="printLableForm()" class="btn btn-link">Напечатать этикетку для выбранных заказов</a><br>';

                    var listItem2 = document.createElement('li');
                    listItem2.className = 'dropdown-item';
                    listItem2.innerHTML += '<a href="#" onclick="printExcel()" class="btn btn-link">Экспорт выбранных заказов в Excel</a>';

                    dropdownMenu.appendChild(listItem1);
                    dropdownMenu.appendChild(listItem2);
                } else {
                    var listItem1 = document.createElement('li');
                    listItem1.className = 'dropdown-item';
                    listItem1.innerHTML = 'Нет выбранных заказов';
                    dropdownMenu.appendChild(listItem1);
                }
            });
        });
    });

    function openOrderForm() {
        getSelectedIdsFromSession(function (selectedIds) {
            var url = '/Orders/CreateOrderToSupplierTransaction?ids=' + selectedIds + '&page=' + @Model.PageNumber;
            window.location.href = url;
        });
    }

    function printLableForm() {
        getSelectedIdsFromSession(function (selectedIds) {
            var url = '/Orders/PrintOrdersLable?ids=' + selectedIds + '&page=' + @Model.PageNumber;
            window.location.href = url;
        });
    }

    function printExcel() {
        getSelectedIdsFromSession(function (selectedIds) {
            var url = '/Orders/PrintOrdersExcel?ids=' + selectedIds + '&page=' + @Model.PageNumber;
            window.location.href = url;
        });
    }

    function getSelectedIdsFromSession(callback) {
        $.get('/YourController/GetSelectedIdsFromSession', function (data) {
            callback(data);
        });
    }
</script>



<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Выберите столбцы для отображения</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
            </div>
            <div class="modal-body-checkbox">
                <div class="container mt-3">
                    <div class="form-group">
                        <style>
                            .form-check-label {
                                user-select: none; /* предотвращает выделение текста */
                                cursor: pointer; /* меняет курсор при наведении */
                            }
                        </style>

                        <div class="form-row">
                            <button type="button" class="btn btn-danger" onclick="clearSelectedIdsSession()">Очистить выбранные поля для изменения</button>
                            <br />
                            <br />
                            @{
                                int checkboxCounter = 1;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Номер заказа"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Номер заказа</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Клиент"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Клиент</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Принят в обработку"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Принят в обработку</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Дата отгрузки"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Дата отгрузки</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Срок доставки"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Срок доставки</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Статус клиента"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Статус клиента</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Статус"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Статус</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Наименование товара"))
                            {
                                <div class="form-group col-md-7">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Наименование товара</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Артикул"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Артикул</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Производитель"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Производитель</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Склад отгрузки"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Склад отгрузки</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Поставщик"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Поставщик</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Номер заказа поставщику"))
                            {
                                <div class="form-group col-md-6">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Номер заказа поставщику</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Цена сайта"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Цена сайта</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Цена"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Цена</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Количество"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Кол.</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Сумма отправления"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Сумма отправления</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Категория"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Категория</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Объемный вес"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Объемный вес</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Цена закупки"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Цена закупки</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Комиссия ОЗОН"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Комиссия Ozon</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Прибыль"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Прибыль</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Наценка %"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Наценка %</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Себестоимость"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Себестоимость</label>
                                </div>
                                checkboxCounter++;
                            }
                            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Город доставки"))
                            {
                                <div class="form-group col-md-5">
                                    <input type="checkbox" class="form-check-input" id="chk@(checkboxCounter)" checked>
                                    <label class="form-check-label" for="chk@(checkboxCounter)">Город доставки</label>
                                </div>
                                checkboxCounter++;
                            }
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</div>


<table class="table" id="shipmentTable">
    <thead>
        <tr>
            <th>
                <div class="d-flex align-items-center">
                    <form asp-action="DelSortStateCookie" method="post" style="margin: 0;">
                        <button type="submit" class="btn btn-link p-0" style="width: 18px; height: 18px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16">
                                <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"></path>
                            </svg>
                            <span class="visually-hidden">Button</span>
                        </button>
                    </form>

                    <p>&nbsp;&nbsp;&nbsp;</p>
                    <a asp-action="Index" asp-route-sortOrder="@ViewBag.FromFileSort" class="d-flex align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-filetype-xlsx" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M14 4.5V11h-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM7.86 14.841a1.13 1.13 0 0 0 .401.823q.195.162.479.252.284.091.665.091.507 0 .858-.158.355-.158.54-.44a1.17 1.17 0 0 0 .187-.656q0-.336-.135-.56a1 1 0 0 0-.375-.357 2 2 0 0 0-.565-.21l-.621-.144a1 1 0 0 1-.405-.176.37.37 0 0 1-.143-.299q0-.234.184-.384.188-.152.513-.152.214 0 .37.068a.6.6 0 0 1 .245.181.56.56 0 0 1 .12.258h.75a1.1 1.1 0 0 0-.199-.566 1.2 1.2 0 0 0-.5-.41 1.8 1.8 0 0 0-.78-.152q-.44 0-.777.15-.336.149-.527.421-.19.273-.19.639 0 .302.123.524t.351.367q.229.143.54.213l.618.144q.31.073.462.193a.39.39 0 0 1 .153.326.5.5 0 0 1-.085.29.56.56 0 0 1-.255.193q-.168.07-.413.07-.176 0-.32-.04a.8.8 0 0 1-.249-.115.58.58 0 0 1-.255-.384zm-3.726-2.909h.893l-1.274 2.007 1.254 1.992h-.908l-.85-1.415h-.035l-.853 1.415H1.5l1.24-2.016-1.228-1.983h.931l.832 1.438h.036zm1.923 3.325h1.697v.674H5.266v-3.999h.791zm7.636-3.325h.893l-1.274 2.007 1.254 1.992h-.908l-.85-1.415h-.035l-.853 1.415h-.861l1.24-2.016-1.228-1.983h.931l.832 1.438h.036z" />
                        </svg>
                    </a>
                </div>
            </th>

            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Номер заказа"))
            {
                <th id="thShipmentNumber">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.ShipmentNumberSort">
                        <small>@(ViewBag.ShipmentNumberSort == OrderSortState.ShipmentNumberAsc ? "Номер заказа↑" : "Номер заказа↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Клиент"))
            {
                <th id="thOzonClient">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.OzonClient">
                        <small>@(ViewBag.OzonClient == OrderSortState.OzonClientAsc ? "Клиент↑" : "Клиент↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Принят в обработку"))
            {
                <th id="thProcessingDate">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.ProcessingDateSort">
                        <small>@(ViewBag.ProcessingDateSort == OrderSortState.ProcessingDateAsc ? "Принят в обработку↑" : "Принят в обработку↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Дата отгрузки"))
            {
                <th id="thShippingDate">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.ShippingDateSort">
                        <small>@(ViewBag.ShippingDateSort == OrderSortState.ShippingDateAsc ? "Дата отгрузки↑" : "Дата отгрузки↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Срок доставки"))
            {
                <th id="thDeliveryPeriod">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.DeliveryPeriodSort">
                        <small>@(ViewBag.DeliveryPeriodSort == OrderSortState.DeliveryPeriodAsc ? "Срок доставки↑" : "Срок доставки↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Статус клиента"))
            {
                <th id="thStatusOzon">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.StatusSort">
                        <small>@(ViewBag.StatusSort == OrderSortState.StatusAsc ? "Статус клиента↑" : "Статус клиента↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Статус"))
            {
                <th id="thStatus">
                    <a class="text-info" asp-action="Index" asp-route-sortOrder="@ViewBag.AppStatusIdSort">
                        <small>@(ViewBag.AppStatusIdSort == OrderSortState.AppStatusIdAsc ? "Статус↑" : "Статус↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Наименование товара"))
            {
                <th id="thProductName" colspan="4" style="white-space: nowrap;">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.ProductNameSort">
                        <small>
                            @(ViewBag.ProductNameSort == OrderSortState.ProductNameAsc ? "Наименование товара↑" : "Наименование товара↓")
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Артикул"))
            {
                <th id="thArticle">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.ArticleSort">
                        <small>@(ViewBag.ArticleSort == OrderSortState.ArticleAsc ? "Артикул↑" : "Артикул↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Производитель"))
            {
                <th id="thManufacturer">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.ManufacturerSort">
                        <small>@(ViewBag.ManufacturerSort == OrderSortState.ManufacturerAsc ? "Производитель↑" : "Производитель↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Склад отгрузки"))
            {
                <th id="thShipmentWarehouse">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.ShipmentWarehouseSort">
                        <small>@(ViewBag.ShipmentWarehouseSort == OrderSortState.ShipmentWarehouseIdAsc ? "Склад отгрузки↑" : "Склад отгрузки↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Поставщик"))
            {
                <th id="thSupplier">
                    <a class="text-info" asp-action="Index" asp-route-sortOrder="@ViewBag.SupplierSort">
                        <small>@(ViewBag.SupplierSort == OrderSortState.SupplierAsc ? "Поставщик↑" : "Поставщик↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Номер заказа поставщику"))
            {
                <th id="thOrderNumberToSupplierSort">
                    <a class="text-info" asp-action="Index" asp-route-sortOrder="@ViewBag.OrderNumberToSupplierSort">
                        <small>@(ViewBag.OrderNumberToSupplierSort == OrderSortState.OrderNumberToSupplierAsc ? "Номер заказа поставщику↑" : "Номер заказа поставщику↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Цена сайта"))
            {
                <th id="thPurchasePrice">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.CurrentPriceSort">
                        <small>@(ViewBag.CurrentPriceSort == OrderSortState.CurrentPriceAsc ? "Цена сайта↑" : "Цена сайта↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Цена"))
            {
                <th id="thPrice">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.PriceSort">
                        <small>@(ViewBag.PriceSort == OrderSortState.PriceAsc ? "Цена↑" : "Цена↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Количество"))
            {
                <th id="thQuantity">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.QuantitySort">
                        <small>@(ViewBag.QuantitySort == OrderSortState.QuantityAsc ? "Кол.↑" : "Кол.↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Сумма отправления"))
            {
                <th id="thShipmentAmount">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.ShipmentAmountSort">
                        <small>@(ViewBag.ShipmentAmountSort == OrderSortState.ShipmentAmountAsc ? "Сумма отправления↑" : "Сумма отправления↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Категория"))
            {
                <th id="thCategory">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.CategorySort">
                        <small>@(ViewBag.CategorySort == OrderSortState.CategoryAsc ? "Категория↑" : "Категория↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Объемный вес"))
            {
                <th id="thVolume">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.VolumeSort">
                        <small>@(ViewBag.VolumeSort == OrderSortState.VolumeAsc ? "Объемный вес↑" : "Объемный вес↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Цена закупки"))
            {
                <th id="thCurrentPrice">
                    <a class="text-info" asp-action="Index" asp-route-sortOrder="@ViewBag.PurchasePriceSort">
                        <small>@(ViewBag.PurchasePriceSort == OrderSortState.PurchasePriceAsc ? "Цена закупки↑" : "Цена закупки↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Комиссия ОЗОН"))
            {
                <th id="thOzonCommission">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.OzonCommissionSort">
                        <small>@(ViewBag.OzonCommissionSort == OrderSortState.MinOzonCommissionAsc ? "Комиссия ОЗОН↑" : "Комиссия ОЗОН↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Прибыль"))
            {
                <th id="thProfit">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.ProfitSort">
                        <small>@(ViewBag.ProfitSort == OrderSortState.ProfitAsc ? "Прибыль↑" : "Прибыль↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Наценка %")) 
            {
                <th id="thDiscount">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.DiscountSort">
                        <small>@(ViewBag.DiscountSort == OrderSortState.DiscountAsc ? "Наценка %↑" : "Наценка %↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Себестоимость"))
            {
                 <th id="thCostPriceсе">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.CostPriceсеSort">
                        <small>@(ViewBag.CostPriceсеSort == OrderSortState.CostPriceAsc ? "Себестоимость↑" : "Себестоимость↓")</small>
                    </a>
                </th>
            }
            @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Город доставки"))
            {
                <th id="thDeliveryCity">
                    <a class="text-dark" asp-action="Index" asp-route-sortOrder="@ViewBag.DeliveryCitySort">
                        <small>@(ViewBag.DeliveryCitySort == OrderSortState.DeliveryCityAsc ? "Город доставки↑" : "Город доставки↓")</small>
                    </a>
                </th>
            }

        </tr>
    </thead>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <tbody>
        <tr>
            <form id="filterForm" asp-action="Index" method="post">
            <td>
                <div class="d-flex align-items-center">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="select-all">
                    </div>

                    <div class="btn-container">
                        <button type="button" class="btn btn-link ml-2" onclick="clearForm()" style="margin-top: -9px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16">
                                <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"></path>
                            </svg>
                            <span class="visually-hidden">Button</span>
                        </button>
                        <button class="btn btn-light clear-btn" onclick="clearSelectedIdsSession()">Очистить выбор</button>
                    </div>
                </div>
            </td>
                @if (Model.User.UserAccess.AvailableOrderColumns.Contains("Номер заказа"))
                {
                        <td>
                            <input asp-for="@Model.FilterModel.ShipmentNumber" id="shipmentNumberFilter" name="ShipmentNumber" class="form-control form-control-sm" />
                        </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Клиент"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.OzonClient" id="ozonClientFilterInput" name="OzonClient" class="form-control form-control-sm" autocomplete="off" />
                    <ul id="ozonClientDropdown" class="dropdown-menu" style="display: none;">
                        <li><a href="#" data-value="Все">&nbsp;Все</a></li>
                            @foreach (var client in ViewBag.Clients)
                            {
                            <li><a href="#" data-value="@client.Value">&nbsp;@client.Text</a></li>
                            }
                    </ul>
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Принят в обработку"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.ProcessingDate" id="processingDateFilter" name="ProcessingDate" class="form-control form-control-xs" type="date" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Дата отгрузки"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.ShippingDate" id="shippingDateFilter" name="ShippingDate" class="form-control form-control-xs" type="date" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Срок доставки"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.DeliveryPeriod" name="DeliveryPeriod" id="deliveryPeriodInput" class="form-control form-control-xs" type="text" placeholder="1 д. 1 ч." />
                </td>
                <script>
                    document.getElementById('deliveryPeriodInput').addEventListener('input', function (e) {
                        let input = e.target.value;

                        // Проверка и добавление "д." после первой цифры и пробела
                        if (input.length > 0 && !input.includes('д.') && input.match(/^\d+ $/)) {
                            e.target.value = input.trim() + ' д. ';
                        }

                        // Проверка и добавление "ч." после второй цифры и пробела
                        const regexDay = /^\d+ д\. \d+ $/;
                        if (regexDay.test(input) && !input.includes('ч.')) {
                            e.target.value = input.trim() + ' ч.';
                        }

                        // Валидация формата
                        const pattern = /^\d+ д\. \d+ ч\.$/;
                        if (!pattern.test(e.target.value)) {
                            e.target.setCustomValidity('Неверный формат. Используйте формат: X д. Y ч.');
                        } else {
                            e.target.setCustomValidity('');
                        }
                    });
                </script>


                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Статус клиента"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.Status" id="statusFilter" name="Status" class="form-control form-control-sm" autocomplete="off" />
                    <ul id="statusDropdown" class="dropdown-menu" style="display: none;">
                        <li><a href="#" data-value="Все">&nbsp;Все</a></li>
                            @foreach (var stat in ViewBag.Statuses)
                            {
                            <li><a href="#" data-value="@stat.Value">&nbsp;@stat.Text</a></li>
                            }
                    </ul>
                </td>
                }
            <script>
                $(document).ready(function () {
                    $('#statusFilter').focus(function () {
                        $('#statusDropdown').show();
                    });

                    $('#statusDropdown').on('click', 'a', function (e) {
                        e.preventDefault();
                        var selectedValue = $(this).data('value');
                        $('#statusFilter').val(selectedValue);
                        $('#statusFilter').focus();
                        $('#statusDropdown').hide();
                    });

                    $(document).on('click', function (e) {
                        if (!$(e.target).closest('#statusFilter').length && !$(e.target).closest('#statusDropdown').length) {
                            $('#statusDropdown').hide();
                        }
                    });
                });
            </script>
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Статус"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.AppStatus" id="appStatusFilterInput" name="AppStatus" class="form-control form-control-sm" autocomplete="off" />
                    <ul id="appStatusDropdown" class="dropdown-menu" style="display: none;">
                        <li><a href="#" data-value="Все">&nbsp;Все</a></li>
                            @foreach (var status in ViewBag.AppStatuses)
                            {
                            <li><a href="#" data-value="@status.Value">&nbsp;@status.Text</a></li>
                            }
                    </ul>
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Наименование товара"))
                {
                <td colspan="4">
                    <input asp-for="@Model.FilterModel.ProductName" id="productNameFilter" name="ProductName" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Артикул"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.Article" id="articleFilter" name="Article" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Производитель"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.Manufacturer" id="manufacturerFilter" name="Manufacturer" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Склад отгрузки"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.ShipmentWarehouse" id="shipmentWarehouseFilter" name="ShipmentWarehouse" class="form-control form-control-sm" autocomplete="off" />
                    <ul id="shipmentWarehouseDropdown" class="dropdown-menu" style="display: none;">
                        <li><a href="#" data-value="Все">&nbsp;Все</a></li>
                            @foreach (var warehous in ViewBag.Warehouses)
                            {
                            <li><a href="#" data-value="@warehous.Value">&nbsp;@warehous.Text</a></li>
                            }
                    </ul>
                </td>
                }
            <script>
                $(document).ready(function () {
                    $('#shipmentWarehouseFilter').focus(function () {
                        $('#shipmentWarehouseDropdown').show();
                    });

                    $('#shipmentWarehouseDropdown').on('click', 'a', function (e) {
                        e.preventDefault();
                        var selectedValue = $(this).data('value');
                        $('#shipmentWarehouseFilter').val(selectedValue);
                        $('#shipmentWarehouseFilter').focus();
                        $('#shipmentWarehouseDropdown').hide();
                    });

                    $(document).on('click', function (e) {
                        if (!$(e.target).closest('#shipmentWarehouseFilter').length && !$(e.target).closest('#shipmentWarehouseDropdown').length) {
                            $('#shipmentWarehouseDropdown').hide();
                        }
                    });
                });
            </script>
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Поставщик"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.Supplier" id="supplierFilter" name="Supplier" class="form-control form-control-sm" autocomplete="off" />
                    <ul id="supplierDropdown" class="dropdown-menu" style="display: none;">
                        <li><a href="#" data-value="Все">&nbsp;Все</a></li>
                            @foreach (var supplier in ViewBag.Suppliers)
                            {
                            <li><a href="#" data-value="@supplier.Value">&nbsp;@supplier.Text</a></li>
                            }
                    </ul>
                </td>
                }
            <script>
                $(document).ready(function () {
                    $('#supplierFilter').focus(function () {
                        $('#supplierDropdown').show();
                    });

                    $('#supplierDropdown').on('click', 'a', function (e) {
                        e.preventDefault();
                        var selectedValue = $(this).data('value');
                        $('#supplierFilter').val(selectedValue);
                        $('#supplierFilter').focus();
                        $('#supplierDropdown').hide();
                    });

                    $(document).on('click', function (e) {
                        if (!$(e.target).closest('#supplierFilter').length && !$(e.target).closest('#supplierDropdown').length) {
                            $('#supplierDropdown').hide();
                        }
                    });
                });
            </script>
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Номер заказа поставщику"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.OrderNumberToSupplier" id="orderNumberToSupplierFilter" name="OrderNumberToSupplier" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Цена сайта"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.CurrentPriceWithDiscount" id="currentPriceWithDiscountFilter" name="CurrentPriceWithDiscount" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Цена"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.Price" id="priceFilter" name="Price" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Количество"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.Quantity" id="quantityFilter" name="Quantity" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Сумма отправления"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.ShipmentAmount" id="shipmentAmountFilter" name="ShipmentAmount" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Категория"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.CommercialCategory" id="commercialCategoryFilter" name="CommercialCategory" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Объемный вес"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.VolumetricWeight" id="volumetricWeightFilter" name="VolumetricWeight" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Цена закупки"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.PurchasePrice" id="purchasePriceFilter" name="PurchasePrice" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Комиссия ОЗОН"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.OzonCommission" id="ozonCommissionFilter" name="OzonCommission" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Прибыль"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.Profit" id="profitFilter" name="Profit" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Наценка %"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.Discount" id="discountFilter" name="Discount" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Себестоимость"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.CostPrice" id="costPriceFilter" name="CostPrice" class="form-control form-control-sm" />
                </td>
                }
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Город доставки"))
                {
                <td>
                    <input asp-for="@Model.FilterModel.DeliveryCity" id="deliveryCityFilter" name="DeliveryCity" class="form-control form-control-sm" />
                </td>
                }

            <button type="submit" id="submitFilterButton" style="display:none;"></button> <!-- Скрытая кнопка для отправки формы -->
            </form>
        </tr>
        @foreach (var item in Model.Items)
        {
            
            string rowClass = item.IsVerified ? "table-active" : "table-danger";
            rowClass = item.Status == "Отменён" ? "custom-gray" : rowClass;
            if (item.IsReturnable.Value != null && item.IsReturnable.Value == true)
            {
                rowClass = "custom-red";
            }
            rowClass = item.IsAccepted ? "table-success" : rowClass;

            rowClass = item.Status == "Отменен покупателем" ? "custom-red" : rowClass;


            <tr class=@rowClass oncontextmenu="showInfoAtCursor('@item.Id', event); return false;">
                <td>
                    <input type="checkbox" class="record-checkbox" data-id="@item.Id">
                    @if (item.FromFile == true)
                    {
                             @if (item.ExcelFileData != null)
                            {
                                <a href="@Url.Action("ViewFile", new { filePath = item.ExcelFileData.FolderName, fileName = item.ExcelFileData.FileName })" target="_blank" onclick="return validateLink('@item.ExcelFileData.FolderName', '@item.ExcelFileData.FileName')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-filetype-xlsx" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M14 4.5V11h-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM7.86 14.841a1.13 1.13 0 0 0 .401.823q.195.162.479.252.284.091.665.091.507 0 .858-.158.355-.158.54-.44a1.17 1.17 0 0 0 .187-.656q0-.336-.135-.56a1 1 0 0 0-.375-.357 2 2 0 0 0-.565-.21l-.621-.144a1 1 0 0 1-.405-.176.37.37 0 0 1-.143-.299q0-.234.184-.384.188-.152.513-.152.214 0 .37.068a.6.6 0 0 1 .245.181.56.56 0 0 1 .12.258h.75a1.1 1.1 0 0 0-.199-.566 1.2 1.2 0 0 0-.5-.41 1.8 1.8 0 0 0-.78-.152q-.44 0-.777.15-.336.149-.527.421-.19.273-.19.639 0 .302.123.524t.351.367q.229.143.54.213l.618.144q.31.073.462.193a.39.39 0 0 1 .153.326.5.5 0 0 1-.085.29.56.56 0 0 1-.255.193q-.168.07-.413.07-.176 0-.32-.04a.8.8 0 0 1-.249-.115.58.58 0 0 1-.255-.384zm-3.726-2.909h.893l-1.274 2.007 1.254 1.992h-.908l-.85-1.415h-.035l-.853 1.415H1.5l1.24-2.016-1.228-1.983h.931l.832 1.438h.036zm1.923 3.325h1.697v.674H5.266v-3.999h.791zm7.636-3.325h.893l-1.274 2.007 1.254 1.992h-.908l-.85-1.415h-.035l-.853 1.415h-.861l1.24-2.016-1.228-1.983h.931l.832 1.438h.036z" />
                                    </svg>
                                </a>
                            }
                            else
                            {
                                <a onclick="showErrorMessage()" class="btn btn-link">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-filetype-xlsx text-danger" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M14 4.5V11h-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM7.86 14.841a1.13 1.13 0 0 0 .401.823q.195.162.479.252.284.091.665.091.507 0 .858-.158.355-.158.54-.44a1.17 1.17 0 0 0 .187-.656q0-.336-.135-.56a1 1 0 0 0-.375-.357 2 2 0 0 0-.565-.21l-.621-.144a1 1 0 0 1-.405-.176.37.37 0 0 1-.143-.299q0-.234.184-.384.188-.152.513-.152.214 0 .37.068a.6.6 0 0 1 .245.181.56.56 0 0 1 .12.258h.75a1.1 1.1 0 0 0-.199-.566 1.2 1.2 0 0 0-.5-.41 1.8 1.8 0 0 0-.78-.152q-.44 0-.777.15-.336.149-.527.421-.19.273-.19.639 0 .302.123.524t.351.367q.229.143.54.213l.618.144q.31.073.462.193a.39.39 0 0 1 .153.326.5.5 0 0 1-.085.29.56.56 0 0 1-.255.193q-.168.07-.413.07-.176 0-.32-.04a.8.8 0 0 1-.249-.115.58.58 0 0 1-.255-.384zm-3.726-2.909h.893l-1.274 2.007 1.254 1.992h-.908l-.85-1.415h-.035l-.853 1.415H1.5l1.24-2.016-1.228-1.983h.931l.832 1.438h.036zm1.923 3.325h1.697v.674H5.266v-3.999h.791zm7.636-3.325h.893l-1.274 2.007 1.254 1.992h-.908l-.85-1.415h-.035l-.853 1.415h-.861l1.24-2.016-1.228-1.983h.931l.832 1.438h.036z" />
                                    </svg>
                                </a>
                            }
                            <script>
                                function validateLink(folderName, fileName) {
                                    if (!folderName || !fileName) {
                                        showErrorMessage();
                                        return false; // Prevent default action (opening the link)
                                    }
                                    return true;
                                }

                                function showErrorMessage() {
                                    // Используйте модальное окно Bootstrap или другой способ отображения сообщения
                                    alert("Ссылка на файл не найдена.");
                                }
                            </script>
                    }
                </td>
                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Номер заказа"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("ShipmentNumber") ? "bg-warning" : "")">
                        @Html.DisplayFor(modelItem => item.ShipmentNumber)
                        @if (item.ShipmentNumber != null && item.ShipmentNumber != "" && @Model.UniqueNumbers[item.ShipmentNumber.Split('-')[0]] != 1)
                        {
                            <a href="javascript:void(0);" onclick="setShipmentNumberFilter('@item.ShipmentNumber.Split('-')[0]')">(@Model.UniqueNumbers[item.ShipmentNumber.Split('-')[0]])</a>
                        }
                    </td>
                    
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Клиент"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("OzonClient") ? "bg-warning" : "")">
                        @if(item.OzonClient != null)
                        {
                            @Html.DisplayFor(modelItem => item.OzonClient.Name)
                        }
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Принят в обработку"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("ProcessingDate") ? "bg-warning" : "")" style="max-width: 150px;" id="td2ProcessingDate">
                        @Html.DisplayFor(modelItem => item.FormattedProcessingDate) <br /> @Html.DisplayFor(modelItem => item.FormattedProcessingTime)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Дата отгрузки"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("ShippingDate") ? "bg-warning" : "")" style="max-width: 150px;">
                        @Html.DisplayFor(modelItem => item.FormattedShippingDate) <br /> @Html.DisplayFor(modelItem => item.FormattedShippingTime)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Срок доставки"))
                {
                    <td style="white-space: nowrap; text-align: right;">
                        @Html.DisplayFor(modelItem => item.FormattedDeliveryDay) 
                        <br />
                        @Html.DisplayFor(modelItem => item.FormattedDeliveryHours)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Статус клиента"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("Status") ? "bg-warning" : "")">
                        @Html.DisplayFor(modelItem => item.Status)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Статус"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("AppStatusId") ? "bg-warning" : "")">
                        @Html.DisplayFor(modelItem => item.AppStatus.Name)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Наименование товара"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("ProductName") ? "bg-warning" : "")" colspan="4">
                        <div class="product-cell">
                            @Html.DisplayFor(modelItem => item.ProductName)
                        </div>
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Артикул"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("Article") ? "bg-warning" : "")">
                        @Html.DisplayFor(modelItem => item.Article)
                        @if (item.ProductKey != null && item.ProductKey != "" && @Model.UniqueArticles[item.ProductKey] != 1)
                        {
                            <a href="javascript:void(0);" onclick="setArticleFilter('@item.ProductKey')">(@Model.UniqueArticles[item.ProductKey])</a>
                        }
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Производитель"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("Manufacturer") ? "bg-warning" : "")">
                        @Html.DisplayFor(modelItem => item.Manufacturer.Name)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Склад отгрузки"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("ShipmentWarehouseId") ? "bg-warning" : "")">
                        @Html.DisplayFor(modelItem => item.ShipmentWarehouse.Name)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Поставщик"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("SupplierId") ? "bg-warning" : "")">
                        @Html.DisplayFor(modelItem => item.Supplier.Name)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Номер заказа поставщику"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("OrderNumberToSupplier") ? "bg-warning" : "")">
                        @Html.DisplayFor(modelItem => item.OrderNumberToSupplier)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Цена сайта"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("ProductInfoId") ? "bg-warning" : "")" style="text-align: right;">
                        @Html.DisplayFor(modelItem => item.ProductInfo.CurrentPriceWithDiscount)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Цена"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("Price") ? "bg-warning" : "")" style="text-align: right;">
                        @Html.DisplayFor(modelItem => item.Price)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Количество"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("Quantity") ? "bg-warning" : "")" style="text-align: center;">
                        @{
                            if (item.Quantity > 1)
                            {
                                <b>
                                    @Html.DisplayFor(modelItem => item.Quantity)
                                </b>
                            }
                            else
                            {
                                @Html.DisplayFor(modelItem => item.Quantity)
                            }
                        }
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Сумма отправления"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("ShipmentAmount") ? "bg-warning" : "")" style="text-align: right;">
                        @Html.DisplayFor(modelItem => item.ShipmentAmount)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Категория"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("ProductInfoId") ? "bg-warning" : "")">
                        @Html.DisplayFor(modelItem => item.ProductInfo.CommercialCategory)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Объемный вес"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("ProductInfoId") ? "bg-warning" : "")" style="text-align: center;">
                        @Html.DisplayFor(modelItem => item.ProductInfo.VolumetricWeight)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Цена закупки"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("PurchasePrice") ? "bg-warning" : "")" style="text-align: right;">
                        @if(item.OriginalPurchasePrice != null)
                        {
                            <p style="white-space: nowrap;">@Html.DisplayFor(modelItem => item.OriginalPurchasePrice) @(" ") @Html.DisplayFor(modelItem => item.Supplier.CurrencyCode)</p>
                        }
                        @Html.DisplayFor(modelItem => item.PurchasePrice)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Комиссия ОЗОН"))
                {
                    <td class="@(item.UpdatedColumns != null && (item.UpdatedColumns.Contains("MinOzonCommission") || item.UpdatedColumns.Contains("MaxOzonCommission")) ? "bg-warning" : "")" style="text-align: right;">
                        @Html.DisplayFor(modelItem => item.MinOzonCommission) <br /> @Html.DisplayFor(modelItem => item.MaxOzonCommission)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Прибыль"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("MinProfit") || item.UpdatedColumns != null && item.UpdatedColumns.Contains("MaxProfit") ? "bg-warning" : "")" style="text-align: right;">
                        @if (item.MaxProfit < 0)
                        {
                            <span style="color:red">@Html.DisplayFor(modelItem => item.MaxProfit)</span>
                        }
                        else
                        {
                            @Html.DisplayFor(modelItem => item.MaxProfit)
                        }
                        <br>
                        @if (item.MinProfit < 0)
                        {
                            <span style="color:red">@Html.DisplayFor(modelItem => item.MinProfit)</span>
                        }
                        else
                        {
                            @Html.DisplayFor(modelItem => item.MinProfit)
                        }
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Наценка %"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("MinDiscount") ? "bg-warning" : "")" style="text-align: right;">
                        @if (item.MaxDiscount < 0)
                        {
                            <span style="color:red">@Html.DisplayFor(modelItem => item.MaxDiscount)</span>
                        }
                        else
                        {
                            @Html.DisplayFor(modelItem => item.MaxDiscount)
                        }
                        <br>
                        @if (item.MinDiscount < 0)
                        {
                            <span style="color:red">@Html.DisplayFor(modelItem => item.MinDiscount)</span>
                        }
                        else
                        {
                            @Html.DisplayFor(modelItem => item.MinDiscount)
                        }
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Себестоимость"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("CostPrice") ? "bg-warning" : "")" style="text-align: right;">
                        @Html.DisplayFor(modelItem => item.CostPrice)
                    </td>
                }

                @if (Model.User.UserAccessId != null && Model.User.UserAccess.AvailableOrderColumns.Contains("Город доставки"))
                {
                    <td class="@(item.UpdatedColumns != null && item.UpdatedColumns.Contains("DeliveryCity") ? "bg-warning" : "")">
                        @Html.DisplayFor(modelItem => item.DeliveryCity)
                        @if (item.DeliveryCity !=  null && item.DeliveryCity != "" && @Model.UniqueDeliveryCitys[item.DeliveryCity] != 1)
                        {
                            <a href="javascript:void(0);" onclick="setDeliveryCityFilter('@item.DeliveryCity')">(@Model.UniqueDeliveryCitys[item.DeliveryCity])</a>
                        }
                    </td>
                }
            </tr>
        }
    </tbody>
</table>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Функция, вызываемая при нажатии клавиши в полях списках
    function handleKeyPress(event) {
        // Проверяем, была ли нажата клавиша Enter
        if (event.key === 'Enter') {
            // Отправляем форму
            submitForm();
            // Предотвращаем стандартное поведение браузера по умолчанию
            event.preventDefault();
        }
    }
</script>



<div class="dropdown" id="contextMenu" style="display: none;">
    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <li><a class="dropdown-item" id="editAction">Изменить</a></li>
        <li><a class="dropdown-item" id="deleteAction">Удалить</a></li>
    </ul>
</div>

<div class="modal fade" id="historyModal" tabindex="-1" aria-labelledby="historyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="historyModalLabel">История заказа</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="historyContent"></div>
            </div>
        </div>
    </div>
</div>


@{
    var isAdmin = User.IsInRole("Admin");
}

<script>
    document.addEventListener('DOMContentLoaded', function () {

        // Функция для отображения окна с информацией по координатам курсора при нажатии на правую кнопку мыши
        window.showInfoAtCursor = function (itemId, event) {
            if (event.button === 2) { // Проверяем, что нажата правая кнопка мыши
                // Создаем или получаем окно
                var infoWindow = document.getElementById("infoWindow");

                // Задаем позицию окна в соответствии с положением курсора
                infoWindow.style.left = (event.clientX + 10) + "px"; // +10 для отступа от курсора по горизонтали
                infoWindow.style.top = (event.clientY + 10) + "px"; // +10 для отступа от курсора по вертикали

                // Заполняем окно информацией
                infoWindow.innerHTML = '';
                infoWindow.innerHTML += '<button class="btn btn-link" onclick="getHistory(' + itemId + '); hideInfo()">История</button><br>';
                infoWindow.innerHTML += '<a href="/Orders/MultiplayEdit?ids=' + itemId + '&page=' + @Model.PageNumber + '" class="btn btn-link" onclick="hideInfo()">Изменить</a><br>';

                getSelectedIdsFromSession(function (selectedIds) {
                    if (selectedIds.length > 0) {
                        infoWindow.innerHTML += '<a href="/Orders/MultiplayEdit?ids=' + selectedIds + '&page=' + @Model.PageNumber + '" class="btn btn-link" onclick="hideInfo()">Изменить выделенные</a><br>';
                    }
                        infoWindow.innerHTML += '<a href="#" class="btn btn-link text-danger" onclick="confirmDelete(' + itemId + ')">Удалить</a><br>';

                        if (selectedIds.length > 0) {
                            // Добавляем ссылку на удаление выделенных с предупреждением
                            infoWindow.innerHTML += '<a href="#" class="btn btn-link text-danger" onclick="confirmMultiDelete()">Удалить выделенные</a><br>';
                        }

                    // Показываем окно
                    infoWindow.style.display = "block";

                    // Предотвращаем стандартное контекстное меню браузера
                    event.preventDefault();

                    // Скрытие окна при клике вне его
                    document.addEventListener("click", function (event) {
                        if (!infoWindow.contains(event.target)) {
                            hideInfo();
                        }
                    });
                });
            }
        }

        // Функция для скрытия окна с информацией
        window.hideInfo = function () {
            var infoWindow = document.getElementById("infoWindow");
            infoWindow.style.display = "none";
        }

        // Чтение значения куки 'PageSize'
        var pageSize = getCookie('PageSize');
        if (pageSize) {
            // Установка значения куки в поле ввода
            document.getElementById('pageSize').value = parseInt(pageSize);
        }
    });

    // Функция для чтения значения куки
    function getCookie(name) {
        var match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
        if (match) return match[2];
    }

    // Функция для получения выбранных ID из сессии
    function getSelectedIdsFromSession(callback) {
        $.get('/YourController/GetSelectedIdsFromSession', function (data) {
            callback(data);
        });
    }

    // Функция для подтверждения удаления выделенных
    function confirmMultiDelete() {
        getSelectedIdsFromSession(function (selectedIds) {
            if (confirm("Вы уверены, что хотите удалить выделенные заказы?")) {
                window.location.href = '/Orders/MultiplayDeleteOrders?ids=' + selectedIds + '&page=' + @Model.PageNumber;
            }
        });
    }

    // Функция для подтверждения удаления одного заказа
    function confirmDelete(itemId) {
        if (confirm("Вы уверены, что хотите удалить этот заказ?")) {
            window.location.href = '/Orders/Delete/' + itemId + '?page=' + @Model.PageNumber;
        }
    }
</script>



<div id="infoWindow"></div>

<form method="post" action="/Orders/SetPageSize" class="input-group mb-3">
    <input type="number" id="pageSize" name="size" class="form-control" placeholder="Размер страницы" aria-label="Размер страницы" aria-describedby="button-addon2" style="max-width: 170px;" required>
    <button class="btn btn-primary" type="submit" id="button-addon1" style="max-width: 160px;">Ввод</button>
</form>

<div class="pagination-wrapper d-flex justify-content-center">
    <div class="pagination-controls">
        @if (Model.TotalPages > 15)
        {
            if (Model.PageNumber <= 8)
            {
                @for (int i = 1; i <= 10; i++)
                {
                    <a asp-action="Index" asp-route-page="@(i)" class="btn btn-primary @(i == Model.PageNumber ? "active" : "")">@i</a>
                }
                <span>...</span>
                <a asp-action="Index" asp-route-page="@Model.TotalPages" class="btn btn-primary">@(Model.TotalPages)</a>
            }
            else if (Model.PageNumber >= Model.TotalPages - 7)
            {
                <a asp-action="Index" asp-route-page="1" class="btn btn-primary">1</a>
                <span>...</span>
                @for (int i = Model.TotalPages - 9; i <= Model.TotalPages; i++)
                {
                    <a asp-action="Index" asp-route-page="@(i)" class="btn btn-primary @(i == Model.PageNumber ? "active" : "")">@i</a>
                }
            }
            else
            {
                <a asp-action="Index" asp-route-page="1" class="btn btn-primary">1</a>
                <span>...</span>
                @for (int i = Model.PageNumber - 5; i <= Model.PageNumber + 5; i++)
                {
                    <a asp-action="Index" asp-route-page="@(i)" class="btn btn-primary @(i == Model.PageNumber ? "active" : "")">@i</a>
                }
                <span>...</span>
                <a asp-action="Index" asp-route-page="@Model.TotalPages" class="btn btn-primary">@(Model.TotalPages)</a>
            }
        }
        else
        {
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <a asp-action="Index" asp-route-page="@(i)" class="btn btn-primary @(i == Model.PageNumber ? "active" : "")">@i</a>
            }
            <span>...</span>
        }
    </div>
</div>

<script>

    // Функция для чтения куки
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    // Функция для обработки состояния каждого чекбокса
    function processCheckboxState(checkboxId, checkboxState) {
        switch (checkboxId) {
            case 'chk1':
                toggleColumnVisibility(1, checkboxState);
                break;
            case 'chk2':
                toggleColumnVisibility(2, checkboxState);
                break;
            case 'chk3':
                toggleColumnVisibility(3, checkboxState);
                break;
            case 'chk4':
                toggleColumnVisibility(4, checkboxState);
                break;
            case 'chk5':
                toggleColumnVisibility(5, checkboxState);
                break;
            case 'chk6':
                toggleColumnVisibility(6, checkboxState);
                break;
            case 'chk7':
                toggleColumnVisibility(7, checkboxState);
                break;
            case 'chk8':
                toggleColumnVisibility(8, checkboxState);
                break;
            case 'chk9':
                toggleColumnVisibility(9, checkboxState);
                break;
            case 'chk10':
                toggleColumnVisibility(10, checkboxState);
                break;
            case 'chk11':
                toggleColumnVisibility(11, checkboxState);
                break;
            case 'chk12':
                toggleColumnVisibility(12, checkboxState);
                break;
            case 'chk13':
                toggleColumnVisibility(13, checkboxState);
                break;
            case 'chk14':
                toggleColumnVisibility(14, checkboxState);
                break;
            case 'chk15':
                toggleColumnVisibility(15, checkboxState);
                break;
            case 'chk16':
                toggleColumnVisibility(16, checkboxState);
                break;
            case 'chk17':
                toggleColumnVisibility(17, checkboxState);
                break;
            case 'chk18':
                toggleColumnVisibility(18, checkboxState);
                break;
            case 'chk19':
                toggleColumnVisibility(19, checkboxState);
                break;
            case 'chk20':
                toggleColumnVisibility(20, checkboxState);
                break;
            case 'chk21':
                toggleColumnVisibility(21, checkboxState);
                break;
            case 'chk22':
                toggleColumnVisibility(22, checkboxState);
                break;
            case 'chk23':
                toggleColumnVisibility(23, checkboxState);
                break;
            case 'chk24':
                toggleColumnVisibility(24, checkboxState);
                break;
            case 'chk25':
                toggleColumnVisibility(25, checkboxState);
                break;
        }
    }

    // Получаем блок modal-body
    const modalBody = document.querySelector('.modal-body-checkbox');

    // Получаем все чекбоксы внутри блока modal-body
    const checkboxes = modalBody.querySelectorAll('input[type="checkbox"]');

    // Устанавливаем начальное состояние чекбоксов из кук
    checkboxes.forEach(function (checkbox) {
        const checkboxId = checkbox.id;
        const checkboxState = getCookie(checkboxId);

        console.log(getCookie(checkboxId));

        if (checkboxState !== undefined) {
            checkbox.checked = checkboxState === 'true';
            processCheckboxState(checkboxId, checkboxState);
        }
    });

    // Перебираем чекбоксы и добавляем обработчик события change
    checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('change', function (event) {
            const checkboxId = event.target.id;
            const checkboxState = event.target.checked;
            document.cookie = `${checkboxId}=${checkboxState}`;
            processCheckboxState(checkboxId, checkboxState);
        });
    });

    // Функция для скрытия и раскрытия столбца таблицы по его ID
    function toggleColumnVisibility(columnIndex, isVisible) {
        const table = document.getElementById("shipmentTable");
        if (table) {
            const rows = table.rows;
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].cells;

                isVisible = typeof isVisible === 'string' ? isVisible.toLowerCase() === 'true' : isVisible;

                if (!isVisible) {
                    console.log("none")
                    cells[columnIndex].style.display = 'none';

                }
                else {
                    console.log("none2")
                    cells[columnIndex].style.display = '';
                }

            }
        }
    }
</script>

<script>
    $(document).ready(function () {
        // Обработка изменений состояния чекбоксов "Выбрать все"
        $('#select-all').change(function () {
            var isChecked = $(this).is(':checked');
            var ids = [];
            $('.record-checkbox').each(function () {
                var id = $(this).data('id');
                $(this).prop('checked', isChecked);
                ids.push(id);
            });

            if (isChecked) {
                addIdsToSession(ids);
            } else {
                removeIdsFromSession(ids);
            }
            displaySelectedIdsFromSession();
        });

        // Обработка изменений состояния отдельных чекбоксов
        $('.record-checkbox').change(function () {
            var id = $(this).data('id');
            if ($(this).is(':checked')) {
                addIdToSession(id);
            } else {
                removeIdFromSession(id);
            }

            // Проверяем, все ли чекбоксы отмечены
            var allChecked = $('.record-checkbox').length === $('.record-checkbox:checked').length;
            $('#select-all').prop('checked', allChecked);

            displaySelectedIdsFromSession();
        });

        // Устанавливаем состояние чекбоксов из сессии при загрузке страницы
        setCheckboxStateFromSession();
    });

    function addIdToSession(id) {
        $.post('/Orders/AddIdToSession', { id: id }, function () {
            console.log("ID added to session: " + id);
        });
    }

    function removeIdFromSession(id) {
        $.post('/Orders/RemoveIdFromSession', { id: id }, function () {
            console.log("ID removed from session: " + id);
        });
    }

    function addIdsToSession(ids) {
        $.ajax({
            url: '/Orders/AddIdsToSession',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(ids),
            success: function () {
                console.log("IDs added to session: " + ids.join(", "));
            }
        });
    }

    function removeIdsFromSession(ids) {
        $.ajax({
            url: '/Orders/RemoveIdsFromSession',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(ids),
            success: function () {
                console.log("IDs removed from session: " + ids.join(", "));
            }
        });
    }

    function getSelectedIdsFromSession(callback) {
        $.get('/Orders/GetSelectedIdsFromSession', function (data) {
            callback(data);
        });
    }

    function displaySelectedIdsFromSession() {
        getSelectedIdsFromSession(function (selectedIds) {
            console.log("Selected IDs: " + selectedIds.join(", "));
        });
    }

    function setCheckboxStateFromSession() {
        getSelectedIdsFromSession(function (selectedIds) {
            var checkboxes = document.querySelectorAll('.record-checkbox');
            checkboxes.forEach(function (checkbox) {
                var itemId = parseInt(checkbox.dataset.id);
                checkbox.checked = selectedIds.includes(itemId);
            });

            // Проверяем, все ли чекбоксы отмечены
            var allChecked = checkboxes.length > 0 && checkboxes.length === document.querySelectorAll('.record-checkbox:checked').length;
            $('#select-all').prop('checked', allChecked);
        });
    }

    function clearSelectedIdsSession() {
        $.post('/Orders/ClearSelectedIdsSession', function () {
            location.reload();
        });
    }
</script>




<script>
    $(document).ready(function () {
        $('#appStatusFilterInput').focus(function () {
            $('#appStatusDropdown').show();
        });

        $('#appStatusDropdown').on('click', 'a', function (e) {
            e.preventDefault();
            var selectedValue = $(this).data('value');
            $('#appStatusFilterInput').val(selectedValue);
            $('#appStatusFilterInput').focus();
            $('#appStatusDropdown').hide();
        });

        $(document).on('click', function (e) {
            if (!$(e.target).closest('#appStatusFilterInput').length && !$(e.target).closest('#appStatusDropdown').length) {
                $('#appStatusDropdown').hide();
            }
        });
    });
</script>

<script>

    $(document).ready(function () {
        $('#ozonClientFilterInput').focus(function () {
            $('#ozonClientDropdown').show();
        });

        $('#ozonClientDropdown').on('click', 'a', function (e) {
            e.preventDefault();
            var selectedValue = $(this).data('value');
            $('#ozonClientFilterInput').val(selectedValue);
            $('#ozonClientFilterInput').focus();
            $('#ozonClientDropdown').hide();
        });

        $(document).on('click', function (e) {
            if (!$(e.target).closest('#ozonClientFilterInput').length && !$(e.target).closest('#ozonClientDropdown').length) {
                $('#ozonClientDropdown').hide();
            }
        });
    });
</script>

<script>
    $(document).ready(function () {
        $('#supplierFilter').focus(function () {
            $('#supplierDropdown').show();
        });

        $('#supplierDropdown').on('click', 'a', function (e) {
            e.preventDefault();
            var selectedValue = $(this).data('value');
            $('#supplierFilter').val(selectedValue);
            $('#supplierFilter').focus();
            $('#supplierDropdown').hide();
        });

        $(document).on('click', function (e) {
            if (!$(e.target).closest('#supplierFilter').length && !$(e.target).closest('#supplierDropdown').length) {
                $('#supplierDropdown').hide();
            }
        });
    });
</script>

<script>
    $(document).ready(function () {
        // Функция для установки куки
        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            var expires = "expires=" + d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        // Функция для получения значения куки
        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        // При загрузке страницы проверяем, был ли установлен куки для подсветки
        var highlightedColumn = getCookie("HighlightedColumn");
        if (highlightedColumn != "") {
            $('#' + highlightedColumn).addClass('active');
        }

        // Обработчик события клика
        $('th a').click(function () {
            // Удаляем класс active у всех заголовков столбцов
            $('th').removeClass('active');
            // Добавляем класс active к текущему заголовку столбца
            var columnId = $(this).closest('th').attr('id');
            $('#' + columnId).addClass('active');
            // Сохраняем id подсвеченного столбца в куки на 1 день
            setCookie("HighlightedColumn", columnId, 1);
        });
    });
</script>

<script>
    function getHistory(orderId) {
        // Отправка запроса на сервер для получения истории заказа
        $.ajax({
            url: '/Orders/GetHistory/' + orderId,
            type: 'GET',
            success: function (data) {

                var orderHistory = data.result;
                // Заполнение таблицы модального окна полученной информацией
                var historyContent = '<table class="table table-striped"><thead><tr><th>Номер заказа</th><th>Клиент</th><th>Принят в обработку</th><th>Дата отгрузки</th><th>Срок доставки</th><th>Статус клиента</th><th>Статус</th><th>Наименование товара</th><th>Артикул</th><th>Производитель</th><th>Склад отгрузки</th><th>Поставщик</th><th>Цена сайта</th><th>Цена</th><th>Кол.</th><th>Сумма отправления</th><th>Категория</th><th>Объемный вес</th><th>Цена закупки</th><th>Комиссия ОЗОН</th><th>Прибыль</th><th>Наценка %</th><th>Себестоимость</th><th>Город доставки</th></tr></thead><tbody>';
                for (var i = 0; i < orderHistory.length; i++) {
                    var order = orderHistory[i].order;

                    console.log(order)
                    // Получаем даты создания и изменения
                    var createdDate = new Date(orderHistory[i].start).toLocaleString();

                    var modifiedDate = new Date(orderHistory[i].end).toLocaleString();

                    var rowClass = order.isAccepted ? "table-success" : "table-active";

                    // Добавляем даты создания и изменения на всю ширину строки
                    historyContent += '<tr class="' + rowClass + '">'
                    if (i == 0) {
                        historyContent += '<td colspan="24">' + '<b>Новый</b>' + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>Создан:</b>' + createdDate + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>Запись была изменена пользователем:</b>' + order.updatedBy + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="/Orders/ConfirmAccepted/' + order.id + '"class="btn btn-success" onclick="hideInfo()">Принять изменение</a> </td>';
                    }
                    else {
                        historyContent += '<td colspan="24">' + '<b>Создан:</b>' + createdDate + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>Изменен:</b>' + modifiedDate + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>Запись была изменена пользователем: </b>' + order.updatedBy + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'
                        historyContent += '<button class="btn btn-primary" onclick="recoverOrder(' + order.id + ', \'' + orderHistory[i].start + '\', \'' + orderHistory[i].end + '\')">Восстановить</button></td>';
                    }
                    historyContent += '<tr class="' + rowClass + '">';
                    // Добавляем информацию о заказе
                    historyContent += '<tr>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("ShipmentNumber ")) ? "bg-warning" : "") + '">' + (order.shipmentNumber != null ? order.shipmentNumber : '') + '</td>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("OzonClient")) ? "bg-warning" : "") + '">' + (order.ozonClient != null ? order.ozonClient.name : '') + '</td>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("ProcessingDate")) ? "bg-warning" : "") + '">' + (order.processingDate != null ? new Date(order.processingDate).toLocaleString() : '') + '</td>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("ShippingDate")) ? "bg-warning" : "") + '">' + (order.shippingDate != null ? new Date(order.shippingDate).toLocaleString() : '') + '</td>';
                    historyContent += '<td>' + (order.formattedDeliveryPeriod != null ? order.formattedDeliveryPeriod : '') + '</td>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("Status")) ? "bg-warning" : "") + '">' + (order.status != null ? order.status : '') + '</td>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("AppStatusId")) ? "bg-warning" : "") + '">' + (order.appStatus != null ? order.appStatus.name : '') + '</td>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("ProductName")) ? "bg-warning" : "") + '">' + (order.productName != null ? order.productName : '') + '</td>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("Article")) ? "bg-warning" : "") + '">' + (order.article != null ? order.article : '') + '</td>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("Article")) ? "bg-warning" : "") + '">' + (order.manufacturer != null ? order.manufacturer.name : '') + '</td>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("ShipmentWarehouseId")) ? "bg-warning" : "") + '">' + (order.shipmentWarehouse != null ? order.shipmentWarehouse.name : '') + '</td>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("SupplierId")) ? "bg-warning" : "") + '">' + (order.supplier != null ? order.supplier.name : '') + '</td>';
                    historyContent += '<td style="text-align: right;" class="' + ((order.updatedColumns != null && order.updatedColumns.includes("ProductInfoId")) ? "bg-warning" : "") + '">' + (order.productInfo != null ? order.productInfo.currentPriceWithDiscount : '') + '</td>';
                    historyContent += '<td style="text-align: right;" class="' + ((order.updatedColumns != null && order.updatedColumns.includes("Price")) ? "bg-warning" : "") + '">' + (order.price != null ? order.price : '') + '</td>';
                    historyContent += '<td style="text-align: center;" class="' + ((order.updatedColumns != null && order.updatedColumns.includes("Quantity")) ? "bg-warning" : "") + '">' + (order.quantity != null ? order.quantity : '') + '</td>';
                    historyContent += '<td style="text-align: right;" class="' + ((order.updatedColumns != null && order.updatedColumns.includes("ShipmentAmount")) ? "bg-warning" : "") + '">' + (order.shipmentAmount != null ? order.shipmentAmount : '') + '</td>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("ProductInfoId")) ? "bg-warning" : "") + '">' + (order.productInfo != null ? order.productInfo.commercialCategory : '') + '</td>';
                    historyContent += '<td style="text-align: center;" class="' + ((order.updatedColumns != null && order.updatedColumns.includes("ProductInfoId")) ? "bg-warning" : "") + '">' + (order.productInfo != null ? order.productInfo.volumetricWeight : '') + '</td>';
                    historyContent += '<td style="text-align: right;" class="' + ((order.updatedColumns != null && order.updatedColumns.includes("PurchasePrice")) ? "bg-warning" : "") + '">' + '<p style="white-space: nowrap;">' + (order.originalPurchasePrice != null ? order.originalPurchasePrice + " " + getCurrencyCode(order.supplier.currencyCode) : '') + '</p>' + (order.purchasePrice != null ? order.purchasePrice : '') + '</td > ';
                    historyContent += '<td style="text-align: right;" class="' + ((order.updatedColumns != null && (order.updatedColumns.includes("MinOzonCommission") || order.updatedColumns.includes("MaxOzonCommission"))) ? "bg-warning" : "") + '">' + (order.minOzonCommission != null ? order.minOzonCommission : '') + '<br>' + (order.maxOzonCommission != null ? order.maxOzonCommission : '') + '</td>';
                    historyContent += '<td style="text-align: right;" class="' + ((order.updatedColumns != null && order.updatedColumns.includes("MinProfit")) ? "bg-warning" : "") + '">' + (order.maxProfit != null ? order.maxProfit + "<br/>" + order.minProfit : '') + '</td>';
                    historyContent += '<td style="text-align: right;" class="' + ((order.updatedColumns != null && order.updatedColumns.includes("MinDiscount")) ? "bg-warning" : "") + '">' + (order.maxDiscount != null ? order.maxDiscount + "<br/>" + order.minDiscount : '') + '</td>';
                    historyContent += '<td style="text-align: right;" class="' + ((order.updatedColumns != null && order.updatedColumns.includes("CostPrice")) ? "bg-warning" : "") + '">' + (order.costPrice != null ? order.costPrice : '') + '</td>';
                    historyContent += '<td class="' + ((order.updatedColumns != null && order.updatedColumns.includes("DeliveryCity")) ? "bg-warning" : "") + '">' + (order.deliveryCity != null ? order.deliveryCity : '') + '</td>';
                    historyContent += '</tr>';



                }
                historyContent += '</tbody></table>';
                // Вставка таблицы в модальное окно
                $('#historyContent').html(historyContent);
                // Отображение модального окна
                $('#historyModal').modal('show');
            },
            error: function () {
                console.error('Ошибка при получении истории заказа');
            }
        });
    }
    function getCurrencyCode(currencyCode) {
        switch (currencyCode) {
            case 0:
                return 'Нет';
            case 1:
                return 'USD';
            case 2:
                return 'EUR';
            case 3:
                return 'RUB';
            case 4:
                return 'BYN';
            default:
                return '';
        }
    }
</script>